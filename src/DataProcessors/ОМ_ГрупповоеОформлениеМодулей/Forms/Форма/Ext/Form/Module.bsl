&НаКлиенте
Процедура ПутьКВыгрузкеКонфигурацииНачалоВыбора(Элемент, ДанныеВыбора, ВыборДобавлением, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	
	ДиалогВыбораПапки = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	ДиалогВыбораПапки.Заголовок = "Выберите каталог выгрузки конфигурации";
	ДиалогВыбораПапки.ПолноеИмяФайла = ПутьКВыгрузкеКонфигурации;
	
	ОповещениеОВыборе = Новый ОписаниеОповещения("ПутьКВыгрузкеКонфигурацииНачалоВыбораЗавершение", ЭтотОбъект);
	ДиалогВыбораПапки.Показать(ОповещениеОВыборе);
КонецПроцедуры

&НаКлиенте
Процедура ПутьКВыгрузкеКонфигурацииНачалоВыбораЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	Если ВыбранныеФайлы <> Неопределено Тогда
		ПутьКВыгрузкеКонфигурации = ВыбранныеФайлы[0];
		ЗаполнитьТаблицуФайлов();
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьТаблицуФайлов()
	Если ПустаяСтрока(ПутьКВыгрузкеКонфигурации) Тогда
		Возврат;
	КонецЕсли;
	
	ФайлыМодулей.Очистить();

	НайденныеФайлы = НайтиФайлы(ПутьКВыгрузкеКонфигурации, "*.bsl", Истина);
	
	Для Каждого Файл Из НайденныеФайлы Цикл
		ОтносительныйПуть = Сред(Файл.Путь, СтрДлина(ПутьКВыгрузкеКонфигурации) + 2);
		ЧастиПути = СтрРазделить(ОтносительныйПуть, ПолучитьРазделительПути(), Ложь);
		
		ТипОбъектаМД = "";
		ИмяОбъектаМД = "";
		
		Если ЧастиПути.Количество() > 0 Тогда
			ТипОбъектаМД = ЧастиПути[0];
		КонецЕсли;
		
		Если ЧастиПути.Количество() > 1 Тогда
			ИмяОбъектаМД = ЧастиПути[1];
		КонецЕсли;
		
		ОстатокПути = "";
		Если ЧастиПути.Количество() > 2 Тогда
			ОстатокПути = СтрСоединить(ЧастиПути, ПолучитьРазделительПути(), 2);
		КонецЕсли;
		
		НоваяСтрока = ФайлыМодулей.Добавить();
		НоваяСтрока.Пометка = Ложь;
		НоваяСтрока.ИмяФайлаМодуля = Лев(Файл.Имя, СтрДлина(Файл.Имя) - 4); // Удаляем расширение .bsl
		НоваяСтрока.ТипОбъектаМД = ТипОбъектаМД;
		НоваяСтрока.ИмяОбъектаМД = ИмяОбъектаМД;
		НоваяСтрока.ОтносительныйПуть = ОстатокПути;
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура Оформить(Команда)
	Если ФайлыМодулей.Количество() = 0 Тогда
		ПоказатьПредупреждение(, "Не найдены файлы для оформления!");
		Возврат;
	КонецЕсли;
	
	ВыбранныеФайлы = Новый Массив;
	
	Для Каждого СтрокаТаблицы Из ФайлыМодулей Цикл
		Если СтрокаТаблицы.Пометка Тогда
			ВыбранныеФайлы.Добавить(СтрокаТаблицы);
		КонецЕсли;
	КонецЦикла;
	
	Если ВыбранныеФайлы.Количество() = 0 Тогда
		ПоказатьПредупреждение(, "Не выбраны файлы для оформления!");
		Возврат;
	КонецЕсли;
	
	// Здесь будет код оформления выбранных файлов
	ПоказатьПредупреждение(, "Выбрано " + ВыбранныеФайлы.Количество() + " файл(ов) для оформления");
КонецПроцедуры
